name: å¾®åšåŸºé‡‘è¯é¢˜æŠ¥å‘Šç”Ÿæˆå™¨

# å·¥ä½œæµçš„è§¦å‘æ¡ä»¶
on:
  # æ¯æ—¥å®šæ—¶è¿è¡Œ (ä¾‹å¦‚ï¼šæ¯æ—¥ UTC æ—¶é—´ 00:00ï¼Œç›¸å½“äºåŒ—äº¬æ—¶é—´ä¸Šåˆ 8 ç‚¹)
  schedule:
    - cron: '0 0 * * *'
  # å…è®¸æ‰‹åŠ¨è§¦å‘ï¼Œå¹¶æä¾›ä¸€ä¸ªè¾“å…¥æ¡†æ¥å®šä¹‰å…³é”®è¯
  workflow_dispatch:
    inputs:
      keywords:
        description: 'è¦æœç´¢çš„å…³é”®è¯ (ç”¨é€—å·åˆ†éš”)ã€‚å¦‚æœç•™ç©ºï¼Œå°†ä½¿ç”¨ main.py ä¸­çš„é»˜è®¤åŸºé‡‘ä¸»é¢˜åˆ—è¡¨ã€‚'
        required: false
        # é»˜è®¤å…³é”®è¯åˆ—è¡¨ï¼Œç¡®ä¿ä¸ main.py ä¸­çš„é»˜è®¤åˆ—è¡¨ä¿æŒä¸€è‡´
        default: 'åŸºé‡‘'

jobs:
  generate_report:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“ æ£€å‡ºä»£ç  (Checkout repository)
      uses: actions/checkout@v4
      # éœ€è¦æ‹‰å–æœ€æ–°çš„æäº¤ï¼Œä»¥ä¾¿ git-auto-commit-action èƒ½å¤ŸæˆåŠŸæäº¤æ–°çš„æŠ¥å‘Š
      with:
        fetch-depth: 0

    - name: ğŸ è®¾ç½® Python ç¯å¢ƒ (Setup Python)
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'

    - name: âš™ï¸ å®‰è£… weibo-scraper åº“ (Install dependencies)
      run: |
        python -m pip install --upgrade pip
        pip install weibo-scraper

    # è®¾ç½® KEYWORDS_ENV ç¯å¢ƒå˜é‡
    - name: ğŸŒ è¿è¡Œå¾®åšæœç´¢è„šæœ¬ (Run script)
      env:
        # ä¼˜å…ˆä½¿ç”¨æ‰‹åŠ¨è§¦å‘æ—¶çš„è¾“å…¥å€¼ï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤å€¼åˆ—è¡¨
        KEYWORDS_ENV: ${{ github.event.inputs.keywords || 'åŸºé‡‘' }}
      run: |
        echo "ä½¿ç”¨çš„å…³é”®è¯: $KEYWORDS_ENV"
        python main.py

    - name: ğŸ’¾ è‡ªåŠ¨æäº¤ç”Ÿæˆçš„æŠ¥å‘Š (Commit report)
      # æäº¤ reports/report.md æ–‡ä»¶
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: "ğŸ¤– è‡ªåŠ¨æ›´æ–°: å¾®åšåŸºé‡‘è¯é¢˜æŠ¥å‘Š (reports/report.md)"
        files: "reports/report.md"
        # è®¾ç½®æäº¤ç”¨æˆ·åå’Œé‚®ç®±
        commit_user_name: 'GitHub Actions Bot'
        commit_user_email: 'actions@github.com'
