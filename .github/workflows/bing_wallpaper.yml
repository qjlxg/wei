name: ğŸ–¼ï¸ Download Bing Daily Image
# 1. è§¦å‘æ¡ä»¶
on:
  # æ‰‹åŠ¨è§¦å‘ï¼šå…è®¸ç”¨æˆ·åœ¨ GitHub Actions ç•Œé¢ç‚¹å‡»æŒ‰é’®è¿è¡Œ
  workflow_dispatch:
 
  # æ–‡ä»¶å˜åŠ¨è§¦å‘ï¼šè„šæœ¬æˆ–å·¥ä½œæµæ–‡ä»¶å˜åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œ
  push:
    paths:
      - 'download_bing_images.py'
      - '.github/workflows/bing_wallpaper.yml'
 
  # å®šæ—¶è§¦å‘ï¼šæ¯æ—¥å®šæ—¶è¿è¡Œ (cron è¡¨è¾¾å¼ä½¿ç”¨ UTC æ—¶é—´)
  # '0 2 * * *' å¯¹åº” UTC 2:00ï¼Œå³ä¸Šæµ·æ—¶åŒº (UTC+8) çš„æ¯å¤©ä¸Šåˆ 10:00
  schedule:
    - cron: '0 2 * * *'
# 2. ç¯å¢ƒå˜é‡ (ç”¨äºç¡®ä¿ Git æäº¤æ—¶é—´æˆ³å’Œè„šæœ¬çš„æ—¶åŒºä¸€è‡´)
env:
  TZ: Asia/Shanghai
 
# 3. ä½œä¸š (Jobs)
jobs:
  download_and_commit:
    runs-on: ubuntu-latest
   
    steps:
      # æ­¥éª¤ 1: æ£€å‡ºä»£ç 
      - name: â¬‡ï¸ Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # è·å–æ‰€æœ‰å†å²è®°å½•ï¼Œç”¨äºåç»­ Git æ“ä½œ
      # æ­¥éª¤ 2: è®¾ç½® Python ç¯å¢ƒ
      - name: âš™ï¸ Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'
      # æ­¥éª¤ 3: å®‰è£…ä¾èµ– (requests)
      - name: ğŸ“¦ Install requests dependency
        run: pip install requests
      # æ­¥éª¤ 4: è¿è¡Œä¸‹è½½è„šæœ¬
      - name: ğŸš€ Run download script
        run: python download_bing_images.py
      # æ­¥éª¤ 5: é…ç½® Git
      - name: ğŸ‘¤ Configure Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
         
      # æ­¥éª¤ 6: æ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„å›¾ç‰‡æ–‡ä»¶æˆ–å˜åŠ¨
      - name: ğŸ” Check for changes
        id: git_status
        run: |
          # æ£€æŸ¥æ˜¯å¦æœ‰æ–°å¢æˆ–ä¿®æ”¹çš„æ–‡ä»¶ï¼ˆåŒ…æ‹¬ untracked filesï¼‰
          if [ -n "$(git status --porcelain)" ]; then
            echo "commit_needed=true" >> $GITHUB_OUTPUT
          else
            echo "commit_needed=false" >> $GITHUB_OUTPUT
          fi
         
      # æ­¥éª¤ 7: æäº¤å’Œæ¨é€ (ä»…åœ¨æœ‰æ–°æ–‡ä»¶æ—¶æ‰§è¡Œ)
      - name: ğŸ“¤ Commit and Push if needed
        if: steps.git_status.outputs.commit_needed == 'true'
        run: |
          git add .
          # ä½¿ç”¨ä¸Šæµ·æ—¶åŒºçš„æ—¶é—´ç”Ÿæˆæäº¤ä¿¡æ¯
          COMMIT_TIME=$(TZ=Asia/Shanghai date +"%Y-%m-%d %H:%M:%S")
          git commit -m "ğŸ–¼ï¸ Bing Daily Image: ${COMMIT_TIME} (Shanghai)"
          git push
